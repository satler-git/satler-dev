+++
title = "sops-nixでできることとできないこと"
date = 2024-11-04
description = "sops-nixを設定しているときにこれできない！！ってなってて詰まったからメモ"

[extra]
comment = true

[taxonomies]
tags = ["Nix", "NixOS"]
+++

sops-nixを設定しているときにこれできない！！ってなってて詰まったからメモ。
sops-nixは秘密を管理するためのツールのsopsをNixで使いやすくするためのモジュール。

## できること

- 暗号化された情報を復号してファイルに書いて配置
    - 普通は`/run/secrets/`に保存される
    - 以下の鍵を使って暗号化できる
        - ~SSH~
            - RSA鍵なら`ssh-to-pgp`を使ってpgp鍵にできる
            - ed25519なら `ssh-to-age`を使ってage鍵にできる
        - age
        - pgp
    - 暗号化された情報を保存するには以下のファイル形式が使える
        - yaml
        - json
        - ini
        - dotenv
        - binary
- 配置されるファイルのパスをビルド時に知る
- `templates`を使って復号化された情報を合成してそのパスを知る
    - 通常は`/run/secrets-rendered/`以下に配置される
- 配置されるファイルの`owner`や権限(`777`とか`0400`とかそういうやつ)を設定する

## できないこと

- ビルドするときに復号化された情報の中身を知る
    - これができるはずだと思って調べて時間を無駄にしてしまった。よく考えれば、鍵はNix storeに存在しないから復号できるはずもないのに

## おわりに

sops-nixは便利。でもどうやっても対応できないのはあるかも

